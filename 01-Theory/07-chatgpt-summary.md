# Тема 7: Процеси и комуникация между тях в ОС

- **Процес** – изпълняваща се програма; всеки процес може да създава подпроцеси (родител/дете); процесите комуникират чрез IPC (споделена памет, съобщения).
- **Пространство от имена** във файловата система е съвкупността от всички дълготрайни обекти (файлове, директории, връзки), които съществуват в системата, организирани чрез уникални имена.
- **Комуникационни канали в Linux**:
    - **FIFO (unnamed pipe)**: използва команда `pipe`, между свързани процеси, без име във ФС.
    - **Именувана тръба (mkfifo)**: специален файл, достъпен от различни процеси, присъства във ФС.
    - **Процес-файл**: чрез `open`, вход-изход между процес и файл.
    - **Socket**: чрез `socket`, за комуникация по мрежа; използва пространство на имената при сървъра.
- **Процесни състояния**:
    - **Running**: използва процесор (подсъстояния: Running, Ready).
    - **Sleeping**: чака събитие (I/O, Time, Signal), не използва CPU.
    - **Stopped**: напълно спрян, неактивен.
    - **Zombie**: процес при приключване, неприключил напълно.
- **Комуникация чрез споделена памет**:
    - Два/повече процеси четат/пишат в обща памет.
    - Предимства: бърза комуникация, директен достъп, двупосочно, не се мина през ядрото на ос за разлика от тръбите.
    - Недостатък: изисква синхронизация, опасност от race condition.
    - Пример: с процес p1 пише и p2 чете от споделена памет
- **Критична секция** - част от кода, която работи със споделени ресурси и трябва да бъде изпълнена атомарно (неделимо)
- **Race condition (Съревнование за ресурси)**:
    - Два процеса едновременно достъпват/променят общ ресурс без да е гарантиран редът на изпълнение.
    - Защита: **критична секция**, атомарни операции, заключвания (lock).
- **Средства за синхронизация**:
    - **Ниско ниво**: spinlock, атомарни инструкции (test-and-set, compare&swap), забрана на прекъсвания.
    - **Високо ниво**: семафори (брояч + списък на чакащи процеси).
- **Deadlock (блокиране)**:
    - Процес чака ресурс, който никога няма да получи; необходими условия: ексклузивност, изчакване, невъзможност за принудително отнемане, кръгова верига.
- **Starvation (гладуване)**: процес дълго време не получава достъп до ресурс (различно от deadlock, при който всички са блокирани).
- **Spinlock синхронизация**:
    - ключалка за ресурс - 0 - свободен, 1 - зает.
    - Процеси чакат в цикъл (busy waiting) да се освободи заключване (ефикасни за къси критични секции; пази от скъпи context switches).
    - без контекстни превключвания, понеже процесите остават активни, т.е. няма приспиване и събуждане
    - Недостатък: губи се CPU време при дълго изчакване.
- **Семафор**:
    - Брояч за достъп до ресурс cnt + списък на приспаните процеси list.
    - Операции:
      - init - инициализира с начална стойност брояча, показва колко процеса могат да достъпят критичната секция едновременно.
      - wait (намалява брояча/приспива, ако не може да влезе)
      - signal (увеличава брояча/събужда процес).
    - **Силен семафор**: опашка FIFO;
    - **Слаб**: без фиксиран ред (може с приоритети). т.е. може да настъпи starvation.
- **Block/wakeup**:
    - Процесите могат да бъдат приспивани, докато чакат събитие, и съответно събуждани при настъпване на събитието.
- **Реализация на комуникационна тръба (pipe) със семафори (1 елемент)**:
    - Семaфори: `free_bytes`, `ready_bytes` (стойности 1/0).
    - Производител: `free_bytes.wait(); write; ready_bytes.signal();`
    - Потребител: `ready_bytes.wait(); read; free_bytes.signal();`
- **Pipe с n елемента (буфер/опашка) със семафори и mutex-и**:
    - Семaфори: `mutex_read`, `mutex_write`, `free_bytes (n)`, `ready_bytes (0)`
    - Производител: `free_bytes.wait(); mutex_write.wait(); add; mutex_write.signal(); ready_bytes.signal();`
    - Потребител: `ready_bytes.wait(); mutex_read.wait(); retrieve; mutex_read.signal(); free_bytes.signal();`
